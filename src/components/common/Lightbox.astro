---
// Lightbox component for gallery
---

<!-- Lightbox Modal -->
<div
  id="lightbox"
  class="fixed inset-0 z-[100] bg-black/95 hidden items-center justify-center"
  role="dialog"
  aria-modal="true"
  aria-label="Image lightbox"
>
  <!-- Close Button -->
  <button
    id="lightbox-close"
    class="absolute top-4 right-4 z-10 p-2 text-white/70 hover:text-white transition-colors"
    aria-label="Close lightbox"
  >
    <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
  </button>

  <!-- Previous Button -->
  <button
    id="lightbox-prev"
    class="absolute left-4 top-1/2 -translate-y-1/2 z-10 p-3 text-white/70 hover:text-white transition-colors bg-black/30 rounded-full hover:bg-black/50"
    aria-label="Previous image"
  >
    <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
  </button>

  <!-- Next Button -->
  <button
    id="lightbox-next"
    class="absolute right-4 top-1/2 -translate-y-1/2 z-10 p-3 text-white/70 hover:text-white transition-colors bg-black/30 rounded-full hover:bg-black/50"
    aria-label="Next image"
  >
    <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
    </svg>
  </button>

  <!-- Image Container -->
  <div class="max-w-7xl max-h-[90vh] px-4">
    <img
      id="lightbox-image"
      src=""
      alt=""
      class="max-w-full max-h-[85vh] object-contain mx-auto"
    />
    <p id="lightbox-caption" class="text-white/80 text-center mt-4 text-sm"></p>
  </div>

  <!-- Image Counter -->
  <div id="lightbox-counter" class="absolute bottom-4 left-1/2 -translate-x-1/2 text-white/60 text-sm">
    <span id="lightbox-current">1</span> / <span id="lightbox-total">1</span>
  </div>
</div>

<script>
  interface LightboxImage {
    src: string;
    alt: string;
  }

  class LightboxController {
    private lightbox: HTMLElement | null;
    private image: HTMLImageElement | null;
    private caption: HTMLElement | null;
    private currentSpan: HTMLElement | null;
    private totalSpan: HTMLElement | null;
    private images: LightboxImage[] = [];
    private currentIndex: number = 0;

    constructor() {
      this.lightbox = document.getElementById('lightbox');
      this.image = document.getElementById('lightbox-image') as HTMLImageElement;
      this.caption = document.getElementById('lightbox-caption');
      this.currentSpan = document.getElementById('lightbox-current');
      this.totalSpan = document.getElementById('lightbox-total');

      this.bindEvents();
    }

    private bindEvents() {
      // Close button
      document.getElementById('lightbox-close')?.addEventListener('click', () => this.close());

      // Navigation buttons
      document.getElementById('lightbox-prev')?.addEventListener('click', () => this.prev());
      document.getElementById('lightbox-next')?.addEventListener('click', () => this.next());

      // Click outside to close
      this.lightbox?.addEventListener('click', (e) => {
        if (e.target === this.lightbox) {
          this.close();
        }
      });

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (!this.lightbox?.classList.contains('hidden')) {
          if (e.key === 'Escape') this.close();
          if (e.key === 'ArrowLeft') this.prev();
          if (e.key === 'ArrowRight') this.next();
        }
      });
    }

    open(images: LightboxImage[], startIndex: number = 0) {
      this.images = images;
      this.currentIndex = startIndex;
      this.updateImage();
      this.lightbox?.classList.remove('hidden');
      this.lightbox?.classList.add('flex');
      document.body.style.overflow = 'hidden';
    }

    close() {
      this.lightbox?.classList.add('hidden');
      this.lightbox?.classList.remove('flex');
      document.body.style.overflow = '';
    }

    prev() {
      this.currentIndex = (this.currentIndex - 1 + this.images.length) % this.images.length;
      this.updateImage();
    }

    next() {
      this.currentIndex = (this.currentIndex + 1) % this.images.length;
      this.updateImage();
    }

    private updateImage() {
      const img = this.images[this.currentIndex];
      if (this.image && img) {
        this.image.src = img.src;
        this.image.alt = img.alt;
      }
      if (this.caption) {
        this.caption.textContent = this.images[this.currentIndex]?.alt || '';
      }
      if (this.currentSpan) {
        this.currentSpan.textContent = String(this.currentIndex + 1);
      }
      if (this.totalSpan) {
        this.totalSpan.textContent = String(this.images.length);
      }
    }
  }

  // Initialize and expose globally
  const lightboxController = new LightboxController();
  (window as any).lightbox = lightboxController;
</script>
