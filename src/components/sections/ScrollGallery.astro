---
interface Props {
  serviceSlug?: string;
  title?: string;
}

const { serviceSlug = '', title = 'Our Work' } = Astro.props;

// Gallery images organized by service category
const galleryImages: Record<string, { src: string; alt: string; category: string }[]> = {
  'plumbing': [
    { src: '/images/projects/bathroom-glass-shower.webp', alt: 'Modern glass shower installation', category: 'plumbing' },
    { src: '/images/projects/bathroom-team-work.webp', alt: 'Professional bathroom work', category: 'plumbing' },
    { src: '/images/projects/bathroom-1.webp', alt: 'Bathroom project', category: 'plumbing' },
  ],
  'bathroom-remodel': [
    { src: '/images/projects/bathroom-glass-shower.webp', alt: 'Modern glass shower installation', category: 'bathroom' },
    { src: '/images/projects/bathroom-team-work.webp', alt: 'Professional bathroom work', category: 'bathroom' },
    { src: '/images/projects/bathroom-1.webp', alt: 'Bathroom project', category: 'bathroom' },
  ],
  'kitchen-remodel': [
    { src: '/images/projects/kitchen-dark-modern.webp', alt: 'Dark modern kitchen', category: 'kitchen' },
    { src: '/images/projects/gallery-kitchen-gray-marble.webp', alt: 'Gray marble kitchen', category: 'kitchen' },
    { src: '/images/projects/kitchen-two-tone.webp', alt: 'Two-tone kitchen design', category: 'kitchen' },
    { src: '/images/projects/gallery-kitchen-dark-subway.webp', alt: 'Kitchen with dark subway tiles', category: 'kitchen' },
    { src: '/images/projects/kitchen-1.webp', alt: 'Kitchen project', category: 'kitchen' },
  ],
  'carpentry': [
    { src: '/images/projects/home-addition.jpg', alt: 'Home addition project', category: 'carpentry' },
    { src: '/images/projects/kitchen-two-tone.webp', alt: 'Custom kitchen cabinets', category: 'carpentry' },
  ],
  'painting': [
    { src: '/images/projects/kitchen-dark-modern.webp', alt: 'Interior painting', category: 'painting' },
    { src: '/images/projects/gallery-kitchen-gray-marble.webp', alt: 'Kitchen painting', category: 'painting' },
  ],
  'general-repairs': [
    { src: '/images/projects/home-addition.jpg', alt: 'Home repairs', category: 'general' },
    { src: '/images/projects/bathroom-team-work.webp', alt: 'Professional repair work', category: 'general' },
  ],
  'electrical': [
    { src: '/images/projects/kitchen-dark-modern.webp', alt: 'Kitchen electrical work', category: 'electrical' },
    { src: '/images/projects/home-addition.jpg', alt: 'Home electrical installation', category: 'electrical' },
  ],
  'doors-windows': [
    { src: '/images/projects/home-addition.jpg', alt: 'Door and window installation', category: 'doors-windows' },
    { src: '/images/projects/bathroom-glass-shower.webp', alt: 'Glass installation', category: 'doors-windows' },
  ],
};

// Default/fallback images for all services
const defaultImages = [
  { src: '/images/projects/bathroom-glass-shower.webp', alt: 'Modern glass shower', category: 'bathroom' },
  { src: '/images/projects/kitchen-dark-modern.webp', alt: 'Dark modern kitchen', category: 'kitchen' },
  { src: '/images/projects/gallery-kitchen-gray-marble.webp', alt: 'Gray marble kitchen', category: 'kitchen' },
  { src: '/images/projects/bathroom-team-work.webp', alt: 'Professional work', category: 'bathroom' },
  { src: '/images/projects/kitchen-two-tone.webp', alt: 'Two-tone kitchen', category: 'kitchen' },
  { src: '/images/projects/home-addition.jpg', alt: 'Home addition', category: 'remodeling' },
  { src: '/images/projects/gallery-kitchen-dark-subway.webp', alt: 'Kitchen with subway tiles', category: 'kitchen' },
];

// Get images for this service or use defaults
const images = serviceSlug && galleryImages[serviceSlug]
  ? galleryImages[serviceSlug]
  : defaultImages;

// Duplicate images to create seamless loop effect
const displayImages = [...images, ...images];
---

<section class="section overflow-hidden bg-neutral-100">
  <div class="container mb-8">
    <h2 class="text-2xl lg:text-3xl font-heading font-bold text-neutral-900 text-center">
      {title}
    </h2>
  </div>

  <!-- Scrolling Gallery Container -->
  <div class="relative w-full" id="scroll-gallery">
    <div
      class="flex gap-4 scroll-gallery-track"
      style="will-change: transform;"
    >
      {displayImages.map((img, index) => (
        <div
          class="flex-shrink-0 w-72 md:w-80 lg:w-96 aspect-[4/3] rounded-xl overflow-hidden"
        >
          <img
            src={img.src}
            alt={img.alt}
            class="w-full h-full object-cover hover:scale-105 transition-transform duration-500"
            width="384"
            height="288"
            loading="lazy"
            decoding="async"
          />
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  .scroll-gallery-track {
    animation: scroll-left 30s linear infinite;
  }

  .scroll-gallery-track:hover {
    animation-play-state: paused;
  }

  @keyframes scroll-left {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  /* Parallax effect on scroll */
  @supports (animation-timeline: scroll()) {
    .scroll-gallery-track {
      animation: parallax-scroll linear;
      animation-timeline: view();
      animation-range: entry 0% exit 100%;
    }

    @keyframes parallax-scroll {
      0% {
        transform: translateX(10%);
      }
      100% {
        transform: translateX(-10%);
      }
    }
  }
</style>

<script>
  // Fallback parallax effect for browsers without scroll-driven animations
  const gallery = document.getElementById('scroll-gallery');
  const track = gallery?.querySelector('.scroll-gallery-track') as HTMLElement;

  if (gallery && track && !CSS.supports('animation-timeline', 'scroll()')) {
    let ticking = false;

    const updateParallax = () => {
      const rect = gallery.getBoundingClientRect();
      const windowHeight = window.innerHeight;

      // Calculate how far through the viewport the element is
      const progress = 1 - (rect.top + rect.height) / (windowHeight + rect.height);

      // Only apply effect when element is in view
      if (progress >= 0 && progress <= 1) {
        const translateX = (progress - 0.5) * 20; // -10% to 10%
        track.style.transform = `translateX(${translateX}%)`;
      }

      ticking = false;
    };

    window.addEventListener('scroll', () => {
      if (!ticking) {
        requestAnimationFrame(updateParallax);
        ticking = true;
      }
    }, { passive: true });

    // Initial call
    updateParallax();
  }
</script>
