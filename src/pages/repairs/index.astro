---
import PillarLayout from '../../layouts/PillarLayout.astro';
import { getCollection } from 'astro:content';
import TrustBar from '../../components/sections/TrustBar.astro';
import EmergencyBand from '../../components/sections/EmergencyBand.astro';
import ScrollGallery from '../../components/sections/ScrollGallery.astro';
import WhyChooseUs from '../../components/sections/WhyChooseUs.astro';
import FeaturedWork from '../../components/sections/FeaturedWork.astro';
import CTAIntermediate from '../../components/sections/CTAIntermediate.astro';
import GoogleReviews from '../../components/sections/GoogleReviews.astro';
import CTASection from '../../components/sections/CTASection.astro';

// Get all services with category 'handyman' (repairs)
const allServices = await getCollection('services');
const repairServices = allServices.filter(s => s.data.category === 'handyman');

// Get all locations for internal linking
const locations = await getCollection('cities');

const pillar = {
  title: "Home Repair Services",
  slug: "repairs",
  description: "Charlotte's trusted home repair team. Plumbing, electrical, carpentry, painting, doors and windows. Family-owned, fully insured, 500+ projects completed across South Charlotte, Matthews, Ballantyne, and surrounding areas.",
  seo: {
    title: "Home Repair & Handyman Services Charlotte NC | iFixx",
    description: "Family-owned handyman services in Charlotte. Plumbing, electrical, carpentry, painting, doors & windows. 5+ years, 500+ projects. Same-day available. Call (980) 391-6833."
  }
};

const services = repairServices.map(s => ({
  name: s.data.title,
  slug: s.slug,
  description: s.data.summary,
  image: s.data.heroImage
}));

// Service image mapping
const serviceImages: Record<string, string> = {
  'plumbing': '/images/projects/plumbing-water-heater-valve-repair-wrench.webp',
  'electrical': '/images/projects/electrical-range-hood-wiring-installation-kitchen.webp',
  'carpentry': '/images/projects/carpentry-baseboard-trim-installation-repair.webp',
  'painting': '/images/projects/painting-drywall-dining-room-wainscoting-chandelier.webp',
  'doors-windows': '/images/projects/door-window-blinds-installation-leveling.webp',
  'quick-fix': '/images/projects/home-repair-tools-collection-workbench-hammer-screwdrivers.webp',
  'furniture-assembly': '/images/projects/furniture-assembly-wooden-shelf-unit-screwdriver.webp',
  'tv-mounting': '/images/projects/tv-mounting-wall-bracket-installation-drilling.webp'
};
---

<PillarLayout pillar={pillar} services={services}>
  <!-- 1. Hero Section â€” matches homepage style -->
  <section class="relative bg-neutral-900 overflow-hidden">
    <div class="absolute inset-0 z-0">
      <img
        src="/images/projects/remodeling-modern-home-exterior-curb-appeal.webp"
        alt="Modern home exterior in Charlotte NC"
        class="w-full h-full object-cover"
        loading="eager"
        fetchpriority="high"
        decoding="async"
      />
      <div class="absolute inset-0 bg-gradient-to-r from-neutral-900/95 via-neutral-900/80 to-neutral-900/40"></div>
    </div>
    <div class="container relative z-10">
      <div class="py-16 md:py-20 lg:py-28">
        <div class="max-w-3xl">
          <!-- Badge â€” like homepage -->
          <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-neutral-800 border border-neutral-700 mb-6">
            <span>ðŸ”§</span>
            <span class="font-bold text-sm tracking-wide uppercase text-white">500+ Projects <span class="text-primary-500">Across Charlotte</span></span>
          </div>

          <!-- Breadcrumb -->
          <nav class="flex items-center gap-2 text-sm text-neutral-400 mb-6">
            <a href="/" class="hover:text-white transition-colors">Home</a>
            <span>/</span>
            <span class="text-primary-500">Repairs</span>
          </nav>

          <h1 class="text-4xl sm:text-5xl lg:text-7xl font-heading font-bold text-white mb-6 leading-tight">
            Your Local Charlotte<br />
            <span class="text-primary-500">Handyman Team</span>
          </h1>
          <p class="text-lg md:text-xl text-neutral-200 mb-6 font-medium">
            Plumbing, Electrical, Carpentry, Painting & Everyday Repairs
          </p>
          <p class="text-base md:text-lg text-neutral-400 mb-8 max-w-xl">
            We've been fixing homes across Charlotte for over 5 years. From a leaky faucet in Myers Park
            to a full electrical panel upgrade in Matthewsâ€”we're the team your neighbors trust.
          </p>

          <div class="flex flex-col sm:flex-row gap-4">
            <a href="/contact" class="btn btn-primary text-lg px-8 py-4">
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Request Free Estimate
            </a>
            <a href="tel:+19803916833" class="btn btn-secondary text-lg px-8 py-4" data-event="phone_click">
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
              Call (980) 391-6833
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 2. Trust Bar -->
  <TrustBar />

  <!-- 3. Services Grid â€” photo cards like homepage -->
  <section class="section bg-white">
    <div class="container">
      <div class="text-center max-w-2xl mx-auto mb-12 lg:mb-16">
        <h2 class="text-3xl lg:text-4xl font-heading font-bold text-neutral-900 mb-4">
          Home Repairs We Handle Every Day
        </h2>
        <p class="text-lg text-neutral-600">
          After 500+ projects across Charlotte, there's not much we haven't seen.
          From older homes in Plaza Midwood to newer builds in Waxhawâ€”we know what Charlotte homes need.
        </p>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {repairServices.map((service) => (
          <a
            href={`/repairs/${service.slug}`}
            class="card group overflow-hidden"
          >
            <div class="aspect-[4/3] overflow-hidden">
              <img
                src={serviceImages[service.slug] || '/images/projects/Ifixx-portfolio1.webp'}
                alt={`${service.data.title} in Charlotte, NC`}
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                loading="lazy"
                decoding="async"
                width="400"
                height="300"
              />
            </div>
            <div class="p-6">
              <h3 class="text-xl font-heading font-bold text-neutral-900 mb-2 group-hover:text-primary-600 transition-colors">
                {service.data.title}
              </h3>
              <p class="text-neutral-600 text-sm mb-4 line-clamp-2">
                {service.data.summary}
              </p>
              <div class="flex items-center text-primary-600 font-heading font-semibold text-sm uppercase tracking-wide">
                Learn More
                <svg class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </div>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- 4. Emergency Band â€” same as homepage -->
  <EmergencyBand />

  <!-- 5. How It Works â€” with image, like homepage ProcessSteps -->
  <section class="section section-alt overflow-hidden">
    <div class="container">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16 items-center">
        <!-- Image Side -->
        <div class="relative order-2 lg:order-1">
          <div class="relative rounded-2xl overflow-hidden shadow-2xl">
            <img
              src="/images/ui/team.webp"
              alt="iFixx professional handyman team at work in Charlotte NC"
              class="w-full h-auto object-cover aspect-[4/3]"
              width="600"
              height="450"
              loading="lazy"
              decoding="async"
            />
            <div class="absolute bottom-4 left-4 bg-white/95 backdrop-blur-sm rounded-lg px-4 py-3 shadow-lg">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-primary-500 rounded-full flex items-center justify-center">
                  <svg class="w-5 h-5 text-neutral-900" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                  </svg>
                </div>
                <div>
                  <p class="font-heading font-bold text-neutral-900 text-sm">500+ Projects</p>
                  <p class="text-xs text-neutral-600">Completed in Charlotte</p>
                </div>
              </div>
            </div>
          </div>
          <div class="absolute -bottom-6 -right-6 w-32 h-32 bg-primary-100 rounded-full -z-10"></div>
        </div>

        <!-- Content Side -->
        <div class="order-1 lg:order-2">
          <div class="mb-10">
            <h2 class="text-3xl lg:text-4xl font-heading font-bold text-neutral-900 mb-4">
              How It Works
            </h2>
            <p class="text-lg text-neutral-600">
              Getting your home repaired has never been easier. Three simple steps to a better home.
            </p>
          </div>

          <div class="space-y-8">
            <div class="flex gap-5">
              <div class="flex-shrink-0">
                <div class="w-14 h-14 rounded-full bg-primary-500 flex items-center justify-center shadow-lg">
                  <span class="text-xl font-heading font-bold text-neutral-900">01</span>
                </div>
                <div class="w-0.5 h-8 bg-primary-200 mx-auto mt-2"></div>
              </div>
              <div class="pt-2">
                <h3 class="text-xl font-heading font-semibold text-neutral-900 mb-2">Tell Us What You Need</h3>
                <p class="text-neutral-600 leading-relaxed">Fill out our quick form or give us a call. Describe your project and we'll get back to you within hours.</p>
              </div>
            </div>
            <div class="flex gap-5">
              <div class="flex-shrink-0">
                <div class="w-14 h-14 rounded-full bg-primary-500 flex items-center justify-center shadow-lg">
                  <span class="text-xl font-heading font-bold text-neutral-900">02</span>
                </div>
                <div class="w-0.5 h-8 bg-primary-200 mx-auto mt-2"></div>
              </div>
              <div class="pt-2">
                <h3 class="text-xl font-heading font-semibold text-neutral-900 mb-2">Get a Free Estimate</h3>
                <p class="text-neutral-600 leading-relaxed">We'll visit your home, assess the work needed, and provide a transparent, no-obligation quote.</p>
              </div>
            </div>
            <div class="flex gap-5">
              <div class="flex-shrink-0">
                <div class="w-14 h-14 rounded-full bg-primary-500 flex items-center justify-center shadow-lg">
                  <span class="text-xl font-heading font-bold text-neutral-900">03</span>
                </div>
              </div>
              <div class="pt-2">
                <h3 class="text-xl font-heading font-semibold text-neutral-900 mb-2">We Get the Job Done</h3>
                <p class="text-neutral-600 leading-relaxed">Our skilled team completes the work on time, on budget, and to your complete satisfaction.</p>
              </div>
            </div>
          </div>

          <div class="mt-10">
            <a href="/contact" class="btn btn-primary text-lg px-8 py-4">
              Get Started Today
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 6. Why Choose Us â€” same component as homepage -->
  <WhyChooseUs />

  <!-- 7. Featured Work â€” project photos grid, same as homepage -->
  <FeaturedWork />

  <!-- 8. Intermediate CTA â€” same as homepage -->
  <CTAIntermediate
    headline="Like What You See?"
    subheadline="Let's discuss your project. Free estimates, no obligation."
    variant="primary"
  />

  <!-- 9. Scroll Gallery â€” bonus visual section -->
  <ScrollGallery title="More of Our Repair Projects" />

  <!-- 10. Google Reviews -->
  <GoogleReviews title="What Charlotte Homeowners Say" />

  <!-- 11. Service Areas -->
  <section class="section section-alt">
    <div class="container">
      <div class="text-center max-w-2xl mx-auto mb-12">
        <h2 class="text-3xl lg:text-4xl font-heading font-bold text-neutral-900 mb-4">
          Service Areas
        </h2>
        <p class="text-lg text-neutral-600">
          We provide home repair services throughout the Charlotte metro area.
        </p>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        {locations.map((location) => (
          <a
            href={`/service-areas/${location.slug}`}
            class="bg-white p-4 rounded-lg text-center hover:bg-primary-50 hover:border-primary-200 border border-neutral-200 transition-colors"
          >
            <span class="font-heading font-semibold text-neutral-900">{location.data.name}</span>
            <span class="text-neutral-500 text-sm ml-1">{location.data.state}</span>
          </a>
        ))}
      </div>

      <div class="text-center mt-8">
        <a href="/service-areas" class="text-primary-600 font-heading font-semibold hover:text-primary-700 transition-colors">
          View All Service Areas â†’
        </a>
      </div>
    </div>
  </section>

  <!-- 12. Final CTA â€” same component as homepage -->
  <CTASection
    headline="Ready to Fix What's Broken?"
    subtext="Get a free estimate and see why Charlotte homeowners trust iFixx for quality repairs."
  />
</PillarLayout>
