---
import { getCollection } from 'astro:content';
import ServiceAreaLayout from '../../layouts/ServiceAreaLayout.astro';
import TrustBar from '../../components/sections/TrustBar.astro';
import WhyChooseUs from '../../components/sections/WhyChooseUs.astro';
import CTASection from '../../components/sections/CTASection.astro';
import QuickEstimateCompact from '../../components/forms/QuickEstimateCompact.astro';

export async function getStaticPaths() {
  const cities = await getCollection('cities');
  return cities.map((city) => ({
    params: { locationSlug: city.slug },
    props: { city }
  }));
}

const { city } = Astro.props;
const { Content } = await city.render();

// Get all services to link from this location
const services = await getCollection('services');

// Service display mapping
const serviceDisplayNames: Record<string, string> = {
  'plumbing': 'Plumbing Services',
  'electrical': 'Electrical Services',
  'painting': 'Painting & Drywall',
  'carpentry': 'Carpentry & Trim',
  'doors-windows': 'Doors & Windows',
  'quick-fix': 'Quick Fixes',
  'kitchen-remodel': 'Kitchen Remodeling',
  'bathroom-remodel': 'Bathroom Remodeling'
};

// Service icons mapping
const serviceIcons: Record<string, string> = {
  'plumbing': 'M3.5 18.5V14H5.5V18.5H3.5ZM8.5 18.5V9.5H10.5V18.5H8.5ZM13.5 18.5V12H15.5V18.5H13.5ZM18.5 18.5V6H20.5V18.5H18.5Z',
  'electrical': 'M12 2L4 12H11L10 22L20 10H13L14 2H12Z',
  'painting': 'M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.1 0-2 .9-2 2v9c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-9c0-1.1-.9-2-2-2zm-8-4c.55 0 1 .45 1 1H11c0-.55.45-1 1-1z',
  'carpentry': 'M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z',
  'doors-windows': 'M10 2H4C2.9 2 2 2.9 2 4V20C2 21.1 2.9 22 4 22H10V2ZM9 17H4V9H9V17ZM14 2V22H20C21.1 22 22 21.1 22 20V4C22 2.9 21.1 2 20 2H14ZM20 17H15V9H20V17Z',
  'quick-fix': 'M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z',
  'kitchen-remodel': 'M18 2.01L6 2c-1.1 0-2 .89-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.11-.9-1.99-2-1.99zM18 20H6v-9.02h12V20zm0-11H6V4h12v5z',
  'bathroom-remodel': 'M7 7c0-.55-.45-1-1-1s-1 .45-1 1 .45 1 1 1 1-.45 1-1zM20 13V4.83c0-.53-.21-1.04-.59-1.41L17.59 1.6c-.38-.38-.88-.59-1.41-.59H8c-1.1 0-2 .9-2 2v10c-2.21 0-4 1.79-4 4v5h2v-3h16v3h2v-5c0-2.21-1.79-4-4-4z'
};

// Location type label
const locationType = city.data.type === 'neighborhood' ? 'Neighborhood' : 'City';
---

<ServiceAreaLayout location={{
  name: city.data.name,
  state: city.data.state,
  region: city.data.region,
  slug: city.slug,
  seo: city.data.seo,
  coordinates: city.data.coordinates
}}>

  <!-- Hero Section -->
  <section class="relative bg-gradient-to-br from-primary-900 via-primary-800 to-primary-900 text-white py-16 lg:py-24">
    <div class="absolute inset-0 bg-black/30"></div>
    <div class="container relative z-10">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 items-center">
        <div>
          <!-- Breadcrumb -->
          <nav class="flex items-center gap-2 text-sm text-white/70 mb-6">
            <a href="/" class="hover:text-white transition-colors">Home</a>
            <span>/</span>
            <a href="/service-areas" class="hover:text-white transition-colors">Service Areas</a>
            <span>/</span>
            <span class="text-white">{city.data.name}, {city.data.state}</span>
          </nav>

          <h1 class="text-4xl lg:text-5xl font-heading font-bold mb-6">
            Handyman & Remodeling Services in {city.data.name}, {city.data.state}
          </h1>
          <p class="text-lg lg:text-xl text-white/90 leading-relaxed mb-8">
            {city.data.localizedIntro}
          </p>

          <!-- Quick Stats -->
          <div class="flex flex-wrap gap-6 mb-8">
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5 text-secondary-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span class="text-white/90">Fully Insured</span>
            </div>
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5 text-secondary-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span class="text-white/90">Same-Day Available</span>
            </div>
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5 text-secondary-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
              </svg>
              <span class="text-white/90">4.9 Star Rated</span>
            </div>
          </div>

          <div class="flex flex-col sm:flex-row gap-4">
            <a href="/contact" class="btn btn-primary text-lg px-8 py-4">
              Get Free Estimate
            </a>
            <a href="tel:+19803916833" class="btn btn-outline-light text-lg px-8 py-4" data-event="phone_click">
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
              (980) 391-6833
            </a>
          </div>
        </div>

        <!-- Quick Estimate Form -->
        <div class="hidden lg:block">
          <div class="bg-white rounded-xl p-6 shadow-xl">
            <h2 class="text-xl font-heading font-bold text-neutral-900 mb-4 text-center">
              Request Your Free Estimate
            </h2>
            <QuickEstimateCompact variant="light" />
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Trust Bar -->
  <TrustBar />

  <!-- Neighborhoods Section -->
  {city.data.neighborhoods && city.data.neighborhoods.length > 0 && (
    <section class="section bg-neutral-50">
      <div class="container">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl font-heading font-bold text-neutral-900 mb-6 text-center">
            {city.data.type === 'neighborhood' ? 'Areas We Serve' : `${city.data.name} Neighborhoods We Serve`}
          </h2>
          <p class="text-lg text-neutral-600 mb-8 text-center">
            Our team provides fast, reliable service throughout {city.data.name} and surrounding areas.
          </p>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {city.data.neighborhoods.map((neighborhood: string) => (
              <div class="bg-white p-4 rounded-lg text-center text-neutral-700 font-medium shadow-sm border border-neutral-200 hover:border-primary-300 transition-colors">
                {neighborhood}
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- Services Section -->
  <section class="section">
    <div class="container">
      <div class="max-w-5xl mx-auto">
        <h2 class="text-3xl font-heading font-bold text-neutral-900 mb-4 text-center">
          Our Services in {city.data.name}
        </h2>
        <p class="text-lg text-neutral-600 mb-10 text-center max-w-2xl mx-auto">
          From quick repairs to complete renovations, we handle it all with expert craftsmanship and professional service.
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {services.map((service) => (
            <a
              href={`/${city.slug}/${service.slug}`}
              class="card p-6 hover:border-primary-500 group"
            >
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 rounded-lg bg-primary-100 flex items-center justify-center flex-shrink-0 group-hover:bg-primary-500 transition-colors">
                  <svg class="w-6 h-6 text-primary-600 group-hover:text-white transition-colors" fill="currentColor" viewBox="0 0 24 24">
                    <path d={serviceIcons[service.slug] || serviceIcons['quick-fix']} />
                  </svg>
                </div>
                <div>
                  <h3 class="text-lg font-heading font-bold text-neutral-900 mb-2 group-hover:text-primary-600 transition-colors">
                    {serviceDisplayNames[service.slug] || service.data.title}
                  </h3>
                  <p class="text-neutral-600 text-sm">
                    {service.data.summary}
                  </p>
                </div>
              </div>
            </a>
          ))}
        </div>
      </div>
    </div>
  </section>

  <!-- Highlights Section -->
  {city.data.highlights && city.data.highlights.length > 0 && (
    <section class="section bg-gradient-to-br from-primary-50 to-white">
      <div class="container">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl font-heading font-bold text-neutral-900 mb-8 text-center">
            Why {city.data.name} Homeowners Choose iFixx
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {city.data.highlights.map((highlight: string) => (
              <div class="flex items-start gap-4 bg-white p-5 rounded-lg shadow-sm">
                <div class="w-8 h-8 rounded-full bg-secondary-100 flex items-center justify-center flex-shrink-0">
                  <svg class="w-5 h-5 text-secondary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                </div>
                <p class="text-neutral-700 font-medium">{highlight}</p>
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- Content Section -->
  <section class="section">
    <div class="container">
      <div class="max-w-3xl mx-auto prose prose-lg prose-neutral">
        <Content />
      </div>
    </div>
  </section>

  <!-- Why Choose Us -->
  <WhyChooseUs />

  <!-- CTA Section -->
  <CTASection />

</ServiceAreaLayout>
