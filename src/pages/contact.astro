---
import BaseLayout from "../layouts/BaseLayout.astro";
import CTASection from "../components/sections/CTASection.astro";

const seoTitle = "Contact Us | iFixx Remodeling & Handyman Services";
const seoDescription =
  "Get a free estimate for your home repair or remodeling project. Contact iFixx in Charlotte, NC. Call us or fill out our quick form. Fast response guaranteed!";

const phoneNumber = "(980) 391-6833";
const phoneHref = "tel:+19803916833";
const email = "ifixx.hs@gmail.com";

// LocalBusiness + ContactPoint Schema for Contact Page
const contactPageSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "@id": "https://ifixxnc.com/#business",
  "name": "iFixx Remodeling & Handyman Services",
  "description": "Professional handyman and remodeling services in Charlotte, NC. Fully insured and 5-star rated.",
  "url": "https://ifixxnc.com",
  "telephone": "+1-980-391-6833",
  "email": "ifixx.hs@gmail.com",
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Charlotte",
    "addressRegion": "NC",
    "postalCode": "28226",
    "addressCountry": "US"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "35.2271",
    "longitude": "-80.8431"
  },
  "areaServed": [
    { "@type": "City", "name": "Charlotte", "containedInPlace": { "@type": "State", "name": "North Carolina" } },
    { "@type": "City", "name": "Matthews", "containedInPlace": { "@type": "State", "name": "North Carolina" } },
    { "@type": "City", "name": "Waxhaw", "containedInPlace": { "@type": "State", "name": "North Carolina" } },
    { "@type": "City", "name": "Pineville", "containedInPlace": { "@type": "State", "name": "North Carolina" } },
    { "@type": "City", "name": "Monroe", "containedInPlace": { "@type": "State", "name": "North Carolina" } },
    { "@type": "City", "name": "Rock Hill", "containedInPlace": { "@type": "State", "name": "South Carolina" } }
  ],
  "priceRange": "$$",
  "openingHoursSpecification": [
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
      "opens": "07:00",
      "closes": "18:00"
    },
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": "Saturday",
      "opens": "08:00",
      "closes": "14:00"
    }
  ],
  "contactPoint": [
    {
      "@type": "ContactPoint",
      "telephone": "+1-980-391-6833",
      "contactType": "customer service",
      "availableLanguage": ["English", "Spanish"],
      "areaServed": "US"
    },
    {
      "@type": "ContactPoint",
      "email": "ifixx.hs@gmail.com",
      "contactType": "sales",
      "availableLanguage": ["English", "Spanish"]
    }
  ],
  "sameAs": [
    "https://facebook.com/ifixxnc",
    "https://instagram.com/ifixxnc"
  ]
};

// Breadcrumb Schema
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://ifixxnc.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Contact",
      "item": "https://ifixxnc.com/contact"
    }
  ]
};
---

<BaseLayout title={seoTitle} description={seoDescription} canonical="/contact">
  <Fragment slot="schema">
    <script type="application/ld+json" set:html={JSON.stringify(contactPageSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
  </Fragment>
  <!-- Hero Section -->
  <section class="bg-gradient-to-br from-neutral-50 to-white py-16 lg:py-20">
    <div class="container">
      <div class="max-w-2xl mx-auto text-center">
        <h1
          class="text-4xl lg:text-5xl font-heading font-bold text-neutral-900 mb-4"
        >
          Get Your Free Estimate
        </h1>
        <p class="text-lg text-neutral-600">
          Ready to start your project? Fill out the form below or give us a
          call. We typically respond within a few hours.
        </p>
      </div>
    </div>
  </section>

  <!-- Contact Content -->
  <section class="section">
    <div class="container">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16">
        <!-- Contact Form -->
        <div>
          <h2 class="text-2xl font-heading font-bold text-neutral-900 mb-6">
            Request a Free Estimate
          </h2>

          <form
            id="contact-form"
            class="space-y-6"
            action="/api/lead"
            method="POST"
          >
            <input type="hidden" name="formType" value="contact" />

            <!-- First Name -->
            <div>
              <label
                for="firstName"
                class="block text-sm font-medium text-neutral-700 mb-2"
              >
                First Name *
              </label>
              <input
                type="text"
                id="firstName"
                name="firstName"
                required
                class="w-full px-4 py-4 rounded-lg border border-neutral-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
                placeholder="John"
              />
            </div>

            <!-- Last Name -->
            <div>
              <label
                for="lastName"
                class="block text-sm font-medium text-neutral-700 mb-2"
              >
                Last Name
              </label>
              <input
                type="text"
                id="lastName"
                name="lastName"
                class="w-full px-4 py-4 rounded-lg border border-neutral-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
                placeholder="Smith"
              />
            </div>

            <!-- Phone -->
            <div>
              <label
                for="phone"
                class="block text-sm font-medium text-neutral-700 mb-2"
              >
                Phone Number *
              </label>
              <input
                type="tel"
                id="phone"
                name="phone"
                required
                class="w-full px-4 py-4 rounded-lg border border-neutral-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
                placeholder="(704) 555-1234"
              />
            </div>

            <!-- Email -->
            <div>
              <label
                for="email"
                class="block text-sm font-medium text-neutral-700 mb-2"
              >
                Email Address
              </label>
              <input
                type="email"
                id="email"
                name="email"
                class="w-full px-4 py-4 rounded-lg border border-neutral-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
                placeholder="john@example.com"
              />
            </div>

            <!-- Service Type -->
            <div>
              <label
                for="service"
                class="block text-sm font-medium text-neutral-700 mb-2"
              >
                Service Needed *
              </label>
              <select
                id="service"
                name="service"
                required
                class="w-full px-4 py-4 rounded-lg border border-neutral-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors bg-white"
              >
                <option value="">Select a service...</option>
                <option value="handyman">Handyman Services</option>
                <option value="painting">Painting & Drywall</option>
                <option value="electrical">Electrical</option>
                <option value="plumbing">Plumbing</option>
                <option value="carpentry">Carpentry</option>
                <option value="bathroom">Bathroom Remodel</option>
                <option value="kitchen">Kitchen Renovation</option>
                <option value="emergency">Emergency Repair</option>
                <option value="other">Other</option>
              </select>
            </div>

            <!-- Message -->
            <div>
              <label
                for="message"
                class="block text-sm font-medium text-neutral-700 mb-2"
              >
                Project Details
              </label>
              <textarea
                id="message"
                name="message"
                rows="4"
                class="w-full px-4 py-4 rounded-lg border border-neutral-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors resize-none"
                placeholder="Tell us about your project..."></textarea>
            </div>

            <!-- Submit -->
            <button type="submit" class="btn btn-primary w-full text-lg py-4">
              <svg
                class="w-5 h-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                ></path>
              </svg>
              Request Free Estimate
            </button>

            <p class="text-sm text-neutral-500 text-center">
              We respect your privacy. Your information will never be shared.
            </p>
          </form>
        </div>

        <!-- Contact Info -->
        <div>
          <h2 class="text-2xl font-heading font-bold text-neutral-900 mb-6">
            Contact Information
          </h2>

          <div class="space-y-6">
            <!-- Phone -->
            <a
              href={phoneHref}
              class="flex items-start gap-4 p-4 rounded-xl bg-neutral-50 hover:bg-primary-50 transition-colors group"
              data-event="phone_click"
            >
              <div
                class="w-12 h-12 rounded-xl bg-primary-100 flex items-center justify-center flex-shrink-0 group-hover:bg-primary-200 transition-colors"
              >
                <svg
                  class="w-6 h-6 text-primary-600"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                  ></path>
                </svg>
              </div>
              <div>
                <p
                  class="font-semibold text-neutral-900 group-hover:text-primary-700"
                >
                  {phoneNumber}
                </p>
                <p class="text-sm text-neutral-500">
                  Monday - Friday: 7am - 6pm
                </p>
                <p class="text-sm text-neutral-500">Saturday: 8am - 2pm</p>
              </div>
            </a>

            <!-- Email -->
            <a
              href={`mailto:${email}`}
              class="flex items-start gap-4 p-4 rounded-xl bg-neutral-50 hover:bg-primary-50 transition-colors group"
            >
              <div
                class="w-12 h-12 rounded-xl bg-primary-100 flex items-center justify-center flex-shrink-0 group-hover:bg-primary-200 transition-colors"
              >
                <svg
                  class="w-6 h-6 text-primary-600"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                  ></path>
                </svg>
              </div>
              <div>
                <p
                  class="font-semibold text-neutral-900 group-hover:text-primary-700"
                >
                  {email}
                </p>
                <p class="text-sm text-neutral-500">
                  We'll respond within 24 hours
                </p>
              </div>
            </a>

            <!-- Service Area -->
            <div class="flex items-start gap-4 p-4 rounded-xl bg-neutral-50">
              <div
                class="w-12 h-12 rounded-xl bg-secondary-100 flex items-center justify-center flex-shrink-0"
              >
                <svg
                  class="w-6 h-6 text-secondary-600"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                  ></path>
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
              </div>
              <div>
                <p class="font-semibold text-neutral-900">Service Area</p>
                <p class="text-sm text-neutral-600">
                  Charlotte, Matthews, Waxhaw, Rock Hill, Pineville, Monroe, and
                  surrounding areas
                </p>
              </div>
            </div>
          </div>

          <!-- Trust Badges -->
          <div class="mt-10 pt-8 border-t border-neutral-200">
            <h3 class="font-semibold text-neutral-900 mb-4">
              Why Trust iFixx?
            </h3>
            <div class="grid grid-cols-2 gap-4">
              <div class="flex items-center gap-2">
                <svg
                  class="w-5 h-5 text-secondary-600"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
                  ></path>
                </svg>
                <span class="text-sm text-neutral-700">Fully Insured</span>
              </div>
              <div class="flex items-center gap-2">
                <svg
                  class="w-5 h-5 text-yellow-500"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                  ></path>
                </svg>
                <span class="text-sm text-neutral-700">5-Star Rated</span>
              </div>
              <div class="flex items-center gap-2">
                <svg
                  class="w-5 h-5 text-secondary-600"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="text-sm text-neutral-700">Fast Response</span>
              </div>
              <div class="flex items-center gap-2">
                <svg
                  class="w-5 h-5 text-secondary-600"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"
                  ></path>
                </svg>
                <span class="text-sm text-neutral-700">Free Estimates</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  const form = document.getElementById("contact-form") as HTMLFormElement;
  const submitBtn = form?.querySelector(
    'button[type="submit"]',
  ) as HTMLButtonElement;
  const originalBtnText = submitBtn?.innerHTML || "Request Free Estimate";

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!submitBtn) return;

    // Reset status
    const existingStatus = form.querySelector(".form-status");
    if (existingStatus) existingStatus.remove();

    // Loading State
    submitBtn.disabled = true;
    submitBtn.innerHTML = `
      <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Sending...
    `;

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    try {
      const response = await fetch("/api/lead", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (!response.ok) throw new Error(result.error || "Submission failed");

      // Success Logic
      form.reset();
      const successMsg = document.createElement("div");
      successMsg.className =
        "form-status p-4 mt-4 bg-green-50 text-green-700 rounded-lg border border-green-200 text-center";
      successMsg.innerHTML = `
        <p class="font-semibold">Thank you for your request!</p>
        <p class="text-sm">We have received your information and will be in touch shortly.</p>
      `;
      form.appendChild(successMsg);

      // GTM / Analytics
      if (typeof window.gtag !== "undefined") {
        window.gtag("event", "generate_lead", {
          event_category: "form",
          event_label: "contact_page",
        });
      }
    } catch (error: any) {
      console.error("Form submission error:", error);

      const errorMsg = document.createElement("div");
      errorMsg.className =
        "form-status p-4 mt-4 bg-red-50 text-red-700 rounded-lg border border-red-200 text-center";
      errorMsg.textContent =
        error.message ||
        "Something went wrong. Please try again or call us directly.";
      form.appendChild(errorMsg);
    } finally {
      // Reset Button
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalBtnText;
    }
  });
</script>
