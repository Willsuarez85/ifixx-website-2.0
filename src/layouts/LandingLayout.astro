---
import '../styles/global.css';

export interface Props {
  title: string;
  description: string;
  ogImage?: string;
  canonical?: string;
}

const {
  title,
  description,
  ogImage = '/images/ui/hero-bg.jpg',
  canonical
} = Astro.props;
const siteUrl = 'https://www.ifixxnc.com';
const fullCanonical = canonical ? `${siteUrl}${canonical}` : Astro.url.href;
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content={description} />
  <meta name="robots" content="noindex, nofollow" />

  <!-- Google Tag + Google Ads -->
  <!-- Google Tag (gtag.js) - GA4 + Google Ads -->
  <!-- Fixed 2026-02-09: Corrected Measurement ID and Ads ID -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XV0NEL86VN" is:inline></script>
  <script is:inline>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XV0NEL86VN');  // GA4 Measurement ID
    gtag('config', 'AW-1170602007'); // Google Ads Conversion Tag
  </script>

  <!-- Capture UTM params -->
  <script is:inline>
    (function(){
      var params = new URLSearchParams(window.location.search);
      ['utm_source','utm_medium','utm_campaign','utm_term','utm_content','gclid'].forEach(function(p){
        var v = params.get(p);
        if(v) sessionStorage.setItem(p, v);
      });
    })();
  </script>

  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="preload" href="/fonts/inter-latin.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="preload" href="/fonts/montserrat-latin.woff2" as="font" type="font/woff2" crossorigin />

  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={`${siteUrl}${ogImage}`} />
  <link rel="canonical" href={fullCanonical} />

  <title>{title}</title>
  <slot name="schema" />
</head>
<body class="min-h-screen bg-white antialiased flex flex-col">
  <!-- Minimal Header -->
  <header class="sticky top-0 z-50 bg-neutral-800 border-b border-neutral-700 shadow-xl">
    <div class="container">
      <div class="flex items-center justify-between h-16">
        <a href="/" class="flex items-center">
          <picture>
            <source srcset="/images/ui/logo.webp" type="image/webp" />
            <img src="/images/ui/logo.png" alt="iFixx Logo" class="h-10 w-auto" width="89" height="40" />
          </picture>
        </a>
        <a href="tel:+19803916833" class="flex items-center gap-2 btn btn-emergency text-sm px-4 py-2">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
          </svg>
          (980) 391-6833
        </a>
      </div>
    </div>
  </header>

  <main class="flex-grow">
    <slot />
  </main>

  <!-- Minimal Footer -->
  <footer class="bg-neutral-900 border-t border-neutral-700 py-6">
    <div class="container text-center">
      <a href="tel:+19803916833" class="text-primary-500 font-bold text-lg hover:text-primary-400 transition-colors">
        (980) 391-6833
      </a>
      <p class="text-neutral-500 text-sm mt-2">
        Â© 2026 iFixx Remodeling & Handyman Services. Charlotte, NC.
      </p>
    </div>
  </footer>
</body>
</html>
