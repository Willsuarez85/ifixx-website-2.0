---
import '../styles/global.css';
import Header from '../components/layout/Header.astro';
import Footer from '../components/layout/Footer.astro';

export interface Props {
  title: string;
  description: string;
  ogImage?: string;
  canonical?: string;
  geoRegion?: string;
  geoPlacename?: string;
}

const {
  title,
  description,
  ogImage = '/images/ui/hero-bg.jpg',
  canonical,
  geoRegion = 'US-NC',
  geoPlacename = 'Charlotte'
} = Astro.props;
const siteUrl = 'https://www.ifixxnc.com';
const fullCanonical = canonical ? `${siteUrl}${canonical}` : Astro.url.href;
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content={description} />

  <!-- Google Tag (gtag.js) - GA4 + Google Ads -->
  <!-- Fixed 2026-02-09: Corrected Measurement ID and Ads ID -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XV0NEL86VN" is:inline></script>
  <script is:inline>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XV0NEL86VN');  // GA4 Measurement ID
    gtag('config', 'AW-17542077404'); // Google Ads Conversion Tag
  </script>
  <!-- Click-to-Call Tracking -->
  <script is:inline>
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('a[href^="tel:"]').forEach(function(link) {
        link.addEventListener('click', function() {
          if (typeof gtag !== 'undefined') {
            gtag('event', 'click_to_call', {
              'event_category': 'engagement',
              'event_label': this.href.replace('tel:', ''),
              'value': 1
            });
            gtag('event', 'conversion', {
              'send_to': 'AW-17542077404/mVQ-CKbl6xPIbENy326xB',
              'value': 50.0,
              'currency': 'USD'
            });
          }
          console.log('[iFIXX] Click-to-Call tracked:', this.href);
        });
      });
    });
  </script>
  <!-- End Google Tag -->

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

  <!-- Preload local fonts for faster rendering -->
  <link rel="preload" href="/fonts/inter-latin.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="preload" href="/fonts/montserrat-latin.woff2" as="font" type="font/woff2" crossorigin />

  <!-- Preload critical hero image for LCP -->
  <link
    rel="preload"
    as="image"
    type="image/webp"
    href="/images/ui/hero-bg.webp"
    imagesrcset="/images/ui/hero-bg-640.webp 640w, /images/ui/hero-bg-1024.webp 1024w, /images/ui/hero-bg.webp 1920w"
    imagesizes="100vw"
    fetchpriority="high"
  />

  <!-- Open Graph / Social -->
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="iFixx Remodeling & Handyman Services" />
  <meta property="og:url" content={fullCanonical} />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={`${siteUrl}${ogImage}`} />
  <meta property="og:image:type" content={ogImage.endsWith('.webp') ? 'image/webp' : ogImage.endsWith('.png') ? 'image/png' : 'image/jpeg'} />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="iFixx Remodeling & Handyman Services - Charlotte, NC" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@ifixxnc" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={`${siteUrl}${ogImage}`} />
  <meta name="twitter:image:alt" content="iFixx Remodeling & Handyman Services - Charlotte, NC" />

  <!-- Canonical -->
  <link rel="canonical" href={fullCanonical} />

  <!-- Additional SEO Meta -->
  <meta name="robots" content="index, follow" />
  <meta name="author" content="iFixx Remodeling & Handyman Services" />
  <meta name="geo.region" content={geoRegion} />
  <meta name="geo.placename" content={geoPlacename} />

  <title>{title}</title>

  <!-- JSON-LD Schema Slot -->
  <slot name="schema" />
</head>
<body class="min-h-screen bg-white antialiased flex flex-col">
  <Header />
  <main class="flex-grow">
    <slot />
  </main>
  <Footer />
  
  <!-- Analytics Slot -->
  <slot name="analytics" />
</body>
</html>
