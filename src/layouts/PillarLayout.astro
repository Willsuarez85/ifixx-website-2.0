---
import BaseLayout from './BaseLayout.astro';

export interface ServiceItem {
  name: string;
  slug: string;
  description: string;
  image?: string;
}

export interface Props {
  pillar: {
    title: string;
    slug: string;
    description: string;
    seo: {
      title: string;
      description: string;
    };
  };
  services: ServiceItem[];
}

const { pillar, services } = Astro.props;

// ItemList schema for the services under this pillar
const itemListSchema = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": pillar.title,
  "description": pillar.description,
  "numberOfItems": services.length,
  "itemListElement": services.map((service, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "name": service.name,
    "url": `https://www.ifixxnc.com/${pillar.slug}/${service.slug}/`
  }))
};

// Service schema for each service
const serviceSchema = {
  "@context": "https://schema.org",
  "@type": "Service",
  "serviceType": pillar.title,
  "provider": {
    "@type": "HomeAndConstructionBusiness",
    "name": "iFixx Remodeling & Handyman Services",
    "telephone": "+1-980-391-6833",
    "url": "https://www.ifixxnc.com",
    "areaServed": {
      "@type": "GeoCircle",
      "geoMidpoint": {
        "@type": "GeoCoordinates",
        "latitude": 35.2271,
        "longitude": -80.8431
      },
      "geoRadius": "50 mi"
    }
  },
  "areaServed": {
    "@type": "State",
    "name": "North Carolina"
  },
  "hasOfferCatalog": {
    "@type": "OfferCatalog",
    "name": pillar.title,
    "itemListElement": services.map(service => ({
      "@type": "Offer",
      "itemOffered": {
        "@type": "Service",
        "name": service.name,
        "description": service.description
      }
    }))
  }
};

// Breadcrumb schema
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://www.ifixxnc.com/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": pillar.title,
      "item": `https://www.ifixxnc.com/${pillar.slug}/`
    }
  ]
};
---

<BaseLayout
  title={pillar.seo.title}
  description={pillar.seo.description}
  canonical={`/${pillar.slug}/`}
>
  <Fragment slot="schema">
    <script type="application/ld+json" set:html={JSON.stringify(itemListSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(serviceSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
  </Fragment>

  <slot />
</BaseLayout>
